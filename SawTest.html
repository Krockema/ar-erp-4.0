
<!doctype HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.0/dist/aframe-extras.min.js"></script>
        <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script> 
        <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
        <script>
            AFRAME.registerComponent('code-to-attach-to-box', {
                init: function () {
                    let model = document.querySelector("#saw");
                    model.addEventListener('click',function(){
                        console.log("click fired")
                        model.addEventListener('animation-finished',function() {
                            model.removeAttribute('animation-mixer');
                        },{once:true});
                
                    //start the animation by appending the animation-mixer
                    model.setAttribute('animation-mixer',{clip: "*",loop: "repeat", repetitions: 2, duration: 2});
                });
            console.log(this.el);
            }
        });
       
       </script>
   </head>
    <body style='margin : 0px; overflow: hidden;'>
        <!-- we add detectionMode and matrixCodeType to tell AR.js to recognize barcode markers -->
        <a-scene renderer="logarithmicDepthBuffer:true;"> 
        <!-- <a-scene renderer="logarithmicDepthBuffer:true;"embedded arjs> -->
            <!--  inspector="https://cdn.jsdelivr.net/gh/aframevr/aframe-inspector@master/dist/aframe-inspector.min.js" embedded stats      position="x z y"-->
            
            <a-marker  type='pattern'  url='assets/pattern-kipper.patt'>
                <a-entity rotatate="0 0 0" position="0 0 0">
                    <a-text position="0 0 0" value="0 0 0" color="red"></a-text>
                    <a-text position="1 0 0" value="1 0 0" color="red"></a-text>
                    <a-text position="0 0 1" value="0 0 1" color="red"></a-text>
                    <a-text position="1 0 1" value="1 0 1" color="red"></a-text>
                    <a-text position="-1 0 0" value="-1 0 0" color="red"></a-text>
                    <a-text position="0 0 -1" value="0 0 -1" color="red"></a-text>
                    <a-text position="1 0 -1" value="1 0 -1" color="red"></a-text>
                    <a-text position="-1 0 1" value="-1 0 1" color="red"></a-text>
                    <a-text position="-1 0 -1" value="-1 0 -1" color="red"></a-text>

  
                    <a-entity id="saw" 
                                code-to-attach-to-box
                                gltf-model="url(models/sawAnimatedMergedBlade.glb)"
                                position="1 0 -1" 
                                scale="0.5 0.5 0.5"
                                rotation="0 0 0"
                    ></a-entity>
                </a-entity>

            </a-marker>
            <a-entity camera>
                <a-cursor></a-cursor> 
            </a-entity>
            <!-- use this 
                <a-cursor></a-cursor>                
                <a-entity camera> to support multiple-markers, otherwise use <a-marker-camera> instead of </a-marker> 
                            <a-marker-camera type='pattern'  url='assets/pattern-kipper.patt' look-controls wasd-controls></a-marker-camera>
                <a-entity camera></a-entity> 
              <a-camera look-controls wasd-controls></a-marker-camera>
            -->
        </a-scene>
    </body>
</html>